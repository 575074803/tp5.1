<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>文章添加</title>
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
  <link rel="stylesheet" href="__ADMIN__/layui/css/layui.css" media="all">
  <link rel="stylesheet" href="__ADMIN__/style/admin.css" media="all">
  <script src="__STATIC__/ueditor/ueditor.config.js" type="text/javascript"></script>
  <script src="__STATIC__/ueditor/ueditor.all.min.js" type="text/javascript"></script>
  <style>
  	.imgBox{border: 1px solid #eee; width:120px; float: left; padding: 5px;position: relative;margin-right: 10px;margin-bottom: 15px;}
  	.imgBox .dImg{display:block; position: absolute;right:-8px;top:-8px;cursor: pointer;}
  	.imageBox{width: 100%;padding: 3px;height: 120px;display:table-cell;text-align: center;  vertical-align: middle;margin-bottom: 10px;}
  	.imageBox img{max-width: 100%;max-height:100px;display: block;height: auto!important;}
  	@media screen and (max-width: 750px){
  		.imgBox,#box_pics{margin: 0 0 15px 0!important;}
  		#box_pics{width: 100%;clear:both;}
  		.layui-word-aux{display: none;}
  	}
  </style>
</head>
<body>
  <div class="layui-fluid">
    <div class="layui-row layui-form layui-col-space15">
        <div class="layui-col-xs6 layui-col-sm7 layui-col-md9 layui-col-space15">
           <div class="layui-card">
             <div class="layui-card-header">商品内容</div>
             <div class="layui-card-body">
                    <div class="layui-form-item">
                      <label class="layui-form-label">所属栏目</label>
                      <div class="layui-input-block">
                        <select name="cate_id" id="cate_id">
                          {volist name="category" id="vo"}
                          <option value="{$vo.id}">{$vo.html}{$vo.catename}</option>
                          {/volist}
                        </select>
                      </div>
                    </div>
                    <div class="layui-form-item">
                      <label class="layui-form-label">所属品牌</label>
                      <div class="layui-input-block">
                        <select name="brand_id" id="brand_id">
                          {volist name="brand" id="vo"}
                          <option value="{$vo.id}">{$vo.html}{$vo.brand_name}</option>
                          {/volist}
                        </select>
                      </div>
                    </div>

                     <div class="layui-form-item">
                       <label class="layui-form-label">标题:</label>
                       <div class="layui-input-block">
                         <input type="text" name="title" id="title" class="layui-input" autocomplete="off" class="layui-input">
                       </div>
                     </div>

                     <div class="layui-form-item">
                       <label class="layui-form-label">商品编码:</label>
                       <div class="layui-input-inline">
                         <input type="text" name="goods_sn" id="goods_sn" class="layui-input" value="">
                       </div>
                     </div>

                     <div class="layui-form-item">
                       <label class="layui-form-label">pc缩略图</label>
                       <div class="layui-input-inline">
                         <input name="picurl"  id="picurl"  class="layui-input" type="text" >
                       </div>
                       <div class="layui-input-inline layui-btn-container" style="width: auto;">
                         <button type="button" class="layui-btn layui-btn-primary" id="test1">
                           <i class="layui-icon">&#xe67c;</i>上传图片
                         </button>
                       </div>
                       <div class="layui-input-inline" style="width:auto;">
                         <img class="layui-upload-img" id="demo1" style="max-width:100px;">
                       </div>
                    </div>

                    <div class="layui-form-item">
                      <label class="layui-form-label">app缩略图</label>
                      <div class="layui-input-inline">
                        <input name="apppicurl"  id="apppicurl"  class="layui-input" type="text" >
                      </div>
                      <div class="layui-input-inline layui-btn-container" style="width: auto;">
                        <button type="button" class="layui-btn layui-btn-primary" id="test2">
                          <i class="layui-icon">&#xe67c;</i>上传图片
                        </button>
                      </div>
                      <div class="layui-input-inline" style="width:auto;">
                        <img class="layui-upload-img" id="demo2" style="max-width:100px;">
                      </div>
                   </div>

                   <div class="layui-form-item">
                     <label class="layui-form-label">多图上传</label>
                     <div class="layui-input-inline layui-btn-container" style="width: auto;">
                       <button type="button" class="layui-btn layui-btn-primary" id="test3">
                         <i class="layui-icon">&#xe67c;</i>上传图片
                       </button>
                     </div>
                     <div class="layui-upload-list " id="show" style="margin-top: 10px;">
                     </div>
                   </div>
                   <div class="layui-form-item">
                     <label class="layui-form-label">销售价:</label>
                     <div class="layui-input-inline">
                       <input type="text" name="saleprice" id="saleprice" class="layui-input" value="">
                     </div>
                   </div>

                   <div class="layui-form-item">
                     <label class="layui-form-label">市场价:</label>
                     <div class="layui-input-inline">
                       <input type="text" name="marketprice" id="marketprice" class="layui-input" value="">
                     </div>
                   </div>

                   <div class="layui-form-item">
                     <label class="layui-form-label">库存:</label>
                     <div class="layui-input-inline">
                       <input type="text" name="goods_number" id="goods_number" class="layui-input" value="">
                     </div>
                   </div>

                   <div class="layui-form-item">
                     <label class="layui-form-label">重量:</label>
                     <div class="layui-input-inline">
                       <input type="text" name="goods_weight" id="goods_weight" class="layui-input" value="">
                     </div>
                   </div>

                   <div class="layui-form-item">
                     <label class="layui-form-label">积分:</label>
                     <div class="layui-input-inline">
                       <input type="text" name="integral" id="integral" class="layui-input" value="">
                     </div>
                   </div>

                    <div class="layui-form-item">
                      <label class="layui-form-label">内容:</label>
                      <div class="layui-input-block">
                         <textarea type="text" name="content" id="content"  style="width:100%;height:400px;"></textarea>
          				 <script>var editor = new UE.ui.Editor();editor.render("content");</script>
                      </div>
                    </div>

                     <div class="layui-form-item">
                       <label class="layui-form-label">关键字:</label>
                       <div class="layui-input-block">
                         <input type="text" name="keywords" id="keywords" class="layui-input" >
                       </div>
                     </div>

                     <div class="layui-form-item">
                       <label class="layui-form-label">描述:</label>
                       <div class="layui-input-block">
                         <textarea type="text" name="desc" id="desc" class="layui-textarea"></textarea>
                       </div>
                     </div>
                     <div class="layui-form-item">
                        <div class="layui-input-block">
                          <button class="layui-btn" onClick="article_save_submit();">提交</button>
                        </div>
                      </div>

             </div>
           </div>
         </div>
        <div class="layui-col-xs6 layui-col-sm5 layui-col-md3">
        <div class="layui-card">
          <div class="layui-card-header">商品属性</div>
          <div class="layui-card-body">

                  <div class="layui-form-item">
                    <label class="layui-form-label">快递费:</label>
                    <div class="layui-input-inline">
                      <input type="text" name="express_fee" id="express_fee" class="layui-input" >
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">税率:</label>
                    <div class="layui-input-inline">
                      <input type="text" name="taxes" id="taxes" class="layui-input" >
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">合作商</label>
                    <div class="layui-input-inline">
                        <select name="commercial_tenant_id" id="commercial_tenant_id"  class="select" >
        					<option value="0">请选择合作商</option>
        					{volist name="category" id="vo"}
        					<option value="{$vo.id}">{$vo.html}{$vo.catename}</option>
        					{/volist}
        				</select>
                    </div>
                  </div>

                  <div class="layui-form-item">
                    <label class="layui-form-label">供应商：</label>
                    <div class="layui-input-inline">
                        <select name="suppliers_id" id="suppliers_id"  class="select" >
        					<option value="0">请选择供应商</option>
        					{volist name="category" id="vo"}
        					<option value="{$vo.id}">{$vo.html}{$vo.catename}</option>
        					{/volist}
        				</select>
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">所属国家</label>
                    <div class="layui-input-inline">
                        <select  name="provider_origin"  id="provider_origin" lay-search>
                            {volist name="country_flag" id="country_flag"}
                            <option value="{$country_flag.name}">{$country_flag.name}</option>
                            {/volist}
                        </select>
                    </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">促销</label>
                    <div class="layui-input-inline">
                        <input type="radio" name="is_on_sale" id="is_on_sale" value="true" title="促销" checked >
                        <input type="radio" name="is_on_sale" id="is_on_sale" value="false" title="不促销" >
                      </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">热卖</label>
                    <div class="layui-input-inline">
                        <input type="radio" name="is_hot" id="is_hot" value="true" title="热卖" checked >
                        <input type="radio" name="is_hot" id="is_hot" value="false" title="不是热卖" >
                      </div>
                  </div>
                  <div class="layui-form-item">
                    <label class="layui-form-label">精品</label>
                    <div class="layui-input-inline">
                        <input type="radio" name="is_best" id="is_best" value="true" title="精品" checked >
                        <input type="radio" name="is_best" id="is_best" value="false" title="不是精品" >
                      </div>
                  </div>

                  <div class="layui-form-item">
                    <label class="layui-form-label">新品</label>
                    <div class="layui-input-inline">
                        <input type="radio" name="is_new" id="is_new" value="true" title="新品" checked >
                        <input type="radio" name="is_new" id="is_new" value="false" title="不是新品" >
                      </div>
                  </div>

                  <div class="layui-form-item">
                    <label class="layui-form-label">浏览:</label>
                    <div class="layui-input-inline">
                      <input type="text" name="hits" id="hits" class="layui-input" value="0">
                    </div>
                  </div>

                <div class="layui-form-item">
                 <label class="layui-form-label">排序:</label>
                 <div class="layui-input-inline">
                   <input name="orderid"  id="orderid"  class="layui-input" type="text" value="<?php echo GetOrderID('lk_goods');?>">
                 </div>
                </div>
                <div class="layui-form-item">
                 <label class="layui-form-label">时间:</label>
                 <div class="layui-input-inline">
                   <input name="addtime"  id="addtime"  class="layui-input" type="text" >
                 </div>
                </div>

                <div class="layui-form-item">
                  <label class="layui-form-label">状态</label>
                  <div class="layui-input-inline">
                      <input type="radio" name="status" id="status" value="true" title="显示" checked >
                      <input type="radio" name="status" id="status" value="false" title="隐藏" >
                    </div>
                </div>
          </div>
        </div>
      </div>
    </div>
  </div>
<script src="__ADMIN__/layui/jquery.min.js"></script>
<script src="__ADMIN__/layui/layui.js"></script>
<script src="__ADMIN__/layui/layui.all.js"></script>
<script type="text/javascript">
layui.use(['laydate','upload'] ,function(){
	var $ = layui.jquery
	,upload = layui.upload;
	var uploadInst = upload.render({
			elem: '#test1',
			url: '{:url("Upload/pic")}',
            before: function(obj){
              //预读本地文件示例，不支持ie8
              obj.preview(function(index, file, result){
                $('#demo1').attr('src', result); //图片链接（base64）
              });
            },
			done: function(res){
                console.log(res);
			if(res.code > 0){
				 $('#picurl').val(res.url);
                 $('#thumb').val(res.thumb);
		    }else{
				return layer.msg('上传失败');
			}
		}
	});
    var uploadInst = upload.render({
			elem: '#test2',
			url: '{:url("Upload/upload")}',
			done: function(res){
				if(res.code > 0){
					 $('#apppicurl').val(res.url);
				}else{
					return layer.msg('上传失败');
				}
			}
		});
    var i = 0;
    var uploadInst = upload.render({
			elem: '#test3',
			url: '{:url("Upload/upload")}',
			multiple: true,
			done: function(res){
				console.log(res.url);
				  var con ='';
				  con+='	<div class="imgBox">';
				  con+='        <img title="点击删除" class="dImg" src="__ADMIN__/X.png">';
				  con+='        <div class="imageBox"><a href="'+res.url+'" target="_blank" title="点击查看">';
				  con+='            <img src="'+res.url+'"></a>';
				  con+='        </div>';
				  con+='        <div>';
				  con+=' 			<input type="hidden" id="imgs_arr['+i+']" name="imgs_arr['+i+']" value="'+res.url+'">';
				  con+='		</div>';
				  con+='  </div>';
				$("#show").append(con);
				i++;
			}
		});
	$("#show").on("click","img",function(){
   		  $(this).parents(".imgBox").remove();
   	});

    var laydate = layui.laydate;
    laydate.render({
     elem: '#addtime' //指定元素
     ,type: 'datetime'
    });
});

  function article_save_submit()
  {
          var classid=$('#classid').val();
          var title=$('#title').val();
          var picurl=$('#picurl').val();
          var thumb=$('#thumb').val();
          var content=editor.getContent();
          var keywords=$('#keywords').val();
          var desc=$('#desc').val();
          var linkurl=$('#linkurl').val();
          var author=$('#author').val();
          var source=$('#source').val();
          var addtime=$('#addtime').val();
          var tags=$("input[name='tags']").val();
          var comment=$('#comment').val();
          var flag=$('#flag').val();
          var status=$("input[name='status']:checked").val();;
          var hits=$('#hits').val();
          var zan=$('#zan').val();
          var cai=$('#cai').val();
          var orderid=$('#orderid').val();
          $.ajax({
                  type: "post",
                  url: "{:url('article/add')}",
                  data:{classid:classid,title:title,picurl:picurl,thumb:thumb,content:content,keywords:keywords,
                        desc:desc,linkurl:linkurl,author:author,source:source,addtime:addtime,status:status,tags:tags,
                        flag:flag,comment:comment,hits:hits,zan:zan,cai:cai,orderid:orderid},
                  dataType: "json",
                  success: function(data){
                      if(data.status==200){
                           layer.msg(data.info ,{icon: 1,time:1000} , function(){
                               var index = parent.layer.getFrameIndex(window.name);
                               parent.$('.btn-refresh').click();
                               parent.layer.close(index);
                           });
                      }else{
                          layer.msg(data.info,{icon: 5,anim: 6,time:1000} , function(){});
                      }
                  }
              });
  }

</script>
</script>
</body>
</html>
